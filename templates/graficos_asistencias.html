{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
  <h1 class="text-danger fw-bold mb-4"><i class="bi bi-person-check-fill me-2"></i> Gr치fico de Asistencias</h1>
  <p class="text-muted">Visualiza los horarios pico de asistencia.</p>

  <!-- Selector de periodo -->
  <div class="mb-3">
    <select id="periodo" class="form-select w-auto">
      <option value="semana">Semana</option>
      <option value="mes">Mes</option>
      <option value="a침o">A침o</option>
    </select>
  </div>

  <!-- Canvas del gr치fico -->
  <div class="card bg-dark text-light shadow-sm p-3">
    <canvas id="graficoAsistencias" height="120"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function cargarDatos(periodo="semana") {
  const response = await fetch(`{% url 'graficos:datos_asistencias' %}?periodo=${periodo}`);
  const data = await response.json();

  grafico.data.labels = data.labels;
  grafico.data.datasets[0].data = data.values;
  grafico.update();
}

const ctx = document.getElementById('graficoAsistencias').getContext('2d');
const grafico = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: [],
    datasets: [{
      label: 'Cantidad de asistencias',
      data: [],
      backgroundColor: 'rgba(220,53,69,0.7)'
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { labels: { color: '#fff' } }
    },
    scales: {
      x: { ticks: { color: '#fff' } },
      y: { ticks: { color: '#fff' } }
    }
  }
});

// Inicializar con semana
cargarDatos("semana");

// Cambiar periodo
document.getElementById("periodo").addEventListener("change", e => {
  cargarDatos(e.target.value);
});
</script>
{% endblock %}
