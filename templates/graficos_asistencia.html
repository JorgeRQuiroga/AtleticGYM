{% extends 'base.html' %}

{% block content %}

<div class="d-flex justify-content-end mb-3">
  <a href="{% url 'graficos:graficos_menu' %}" class="btn btn-outline-light d-flex align-items-center gap-2">
    <i class="bi bi-arrow-left-circle fs-5"></i> Volver
  </a>
</div>

<h2 class="text-center mb-5">游늵 Gr치ficos de Asistencias</h2>

<div class="row">
  <!-- Gr치fico 1: Asistencias Mensual del a침o -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-body bg-dark text-light text-center">
        <h5 class="mb-3">Asistencias Mensual del {% now "Y" %}</h5>
        <div class="chart-container" style="position: relative; height:220px; width:100%">
          <canvas id="graficoMes"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Gr치fico 2: Asistencias por D칤a de la Semana -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-body bg-dark text-light text-center">
        <h5 class="mb-3">Asistencias por D칤a de la Semana</h5>
        <div class="chart-container" style="position: relative; height:220px; width:100%">
          <canvas id="graficoDia"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Gr치fico 3: Asistencias por Hora pico -->
  <div class="col-md-12 mb-4">
    <div class="card h-100">
      <div class="card-body bg-dark text-light text-center">
        <h5 class="mb-3">Asistencias por Hora del D칤a</h5>
        <div class="chart-container" style="position: relative; height:220px; width:100%">
          <canvas id="graficoHora"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Gr치fico 1: Asistencias por mes
  const ctxMes = document.getElementById('graficoMes').getContext('2d');
  new Chart(ctxMes, {
    type: 'bar',
    data: {
      labels: {{ meses|safe }},
      datasets: [{
        label: 'Cantidad de asistencias',
        data: {{ totales_mes|safe }},
        backgroundColor: 'rgba(0,188,212,0.35)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: { y: { beginAtZero: true } },
      plugins: { legend: { position: 'bottom' } }
    }
  });

  // Gr치fico 2: Asistencias por d칤a de la semana
  const ctxDia = document.getElementById('graficoDia').getContext('2d');
  new Chart(ctxDia, {
    type: 'bar',
    data: {
      labels: {{ dias_semana_labels|safe }},
      datasets: [{
        label: 'Asistencias',
        data: {{ totales_dia|safe }},
        backgroundColor: 'rgba(25,62,185,1)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  // Gr치fico 3: Asistencias por hora
  const ctxHora = document.getElementById('graficoHora').getContext('2d');
  new Chart(ctxHora, {
    type: 'line',
    data: {
      labels: {{ horas|safe }},
      datasets: [{
        label: 'Asistencias',
        data: {{ totales_hora|safe }},
        borderColor: 'rgba(255, 99, 132, 1)',
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: { y: { beginAtZero: true } },
      plugins: { legend: { position: 'bottom' } }
    }
  });
</script>

{% endblock %}
