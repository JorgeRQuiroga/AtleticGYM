
<div class="modal fade" id="editarMembresiaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header border-bordo">
        <h5 class="modal-title text-primary">Editar membresía</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- Contenedor dinámico donde se inyectará el formulario -->
      <div id="modalBody">
        <form id="membresia-editar-form" method="post" action="{% url 'membresias:membresias_editar' membresia.pk %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                {{ form.nombre.label_tag }}
                {{ form.nombre }}
                {% if form.nombre.errors %}
                  <div class="text-danger small">{{ form.nombre.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                {{ form.apellido.label_tag }}
                {{ form.apellido }}
                {% if form.apellido.errors %}
                  <div class="text-danger small">{{ form.apellido.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                {{ form.dni.label_tag }}
                {{ form.dni }}
                {% if form.dni.errors %}
                  <div class="text-danger small">{{ form.dni.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                {{ form.telefono.label_tag }}
                {{ form.telefono }}
                {% if form.telefono.errors %}
                  <div class="text-danger small">{{ form.telefono.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                {{ form.emergencia.label_tag }}
                {{ form.emergencia }}
              </div>
              <div class="col-md-6">
                {{ form.domicilio.label_tag }}
                {{ form.domicilio }}
              </div>
              <div class="col-md-6">
                {{ form.email.label_tag }}
                {{ form.email }}
              </div>
              <div class="col-md-6">
                {{ form.servicio.label_tag }}
                {{ form.servicio }}
                {% if form.servicio.errors %}
                  <div class="text-danger small">{{ form.servicio.errors }}</div>
                {% endif %}
              </div>
              <div class="col-12">
                {{ form.observaciones.label_tag }}
                {{ form.observaciones }}
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Guardar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('editarMembresiaModal');
  
  // Manejar el submit del formulario ya cargado en la página
  const form = document.getElementById('membresia-editar-form');
  if (form) {
    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      const formData = new FormData(form);
      
      try {
        const resp = await fetch(form.action, {
          method: 'POST',
          body: formData,
          credentials: 'same-origin',
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        });
        
        const data = await resp.json();
        
        if (data.ok) {
          // Cerrar modal
          const bsModal = bootstrap.Modal.getInstance(modal);
          if (bsModal) {
            bsModal.hide();
          }
          // Recargar página para mostrar cambios
          location.reload();
        } else {
          // Mostrar errores sin recargar
          if (data.html) {
            document.getElementById('modalBody').innerHTML = data.html;
          } else if (data.errors) {
            alert('Error: ' + JSON.stringify(data.errors));
          }
        }
      } catch (error) {
        console.error('Error al guardar:', error);
        alert('Hubo un error al guardar los cambios');
      }
    });
  }
});
</script>